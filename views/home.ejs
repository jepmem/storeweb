<!DOCTYPE html>
<html>
<head>
  <title>JPN</title>
  <link rel="stylesheet" href="/styles/style.css">
</head>
<body>
  <%- include('partials/header'); %>

  <main>
    <h1>JPN, Our latest products, come see what's new.</h1>
    
    <% if (!products || products.length === 0) { %>
      <p>ยังไม่มีสินค้า</p>
    <% } else { %>
      <div class="grid">
        <% products.forEach((p) => { %>
          <div class="card">
            <img src="<%= p.image_url || '/images/placeholder.png' %>" alt="">
            <h3><%= p.name %></h3>
            <p class="price">฿<%= Number(p.price).toFixed(2) %></p>
            <p class="stock">คงเหลือ: <%= p.stock %></p>

            <form action="/cart/add/<%= p.id %>" method="POST">
              <div class="buyrow">
                <input type="number" name="qty" value="1" min="1" max="<%= Math.max(p.stock,1) %>">
                <button class="btn" type="submit" <%= p.stock <= 0 ? 'disabled' : '' %>>ใส่ตะกร้า</button>
              </div>
            </form>
          </div>
        <% }); %>
      </div>
    <% } %>

    <% if (typeof ok !== "undefined") { %>
      <p class="success">สั่งซื้อสำเร็จ!</p>
    <% } %>
  </main>
  
</body>
</html>
